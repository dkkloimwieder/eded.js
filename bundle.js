!function(){"use strict";function r(r,e){var t=Object.keys(r);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(r);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),t.push.apply(t,n)}return t}function e(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(r){o(e,r,n[r])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))}))}return e}function t(r){return t="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(r){return typeof r}:function(r){return r&&"function"==typeof Symbol&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},t(r)}function n(){n=function(r,e){return new t(r,void 0,e)};var r=RegExp.prototype,e=new WeakMap;function t(r,n,u){var i=new RegExp(r,n);return e.set(i,u||e.get(r)),f(i,t.prototype)}function u(r,t){var n=e.get(t);return Object.keys(n).reduce((function(e,t){return e[t]=r[n[t]],e}),Object.create(null))}return a(t,RegExp),t.prototype.exec=function(e){var t=r.exec.call(this,e);return t&&(t.groups=u(t,this)),t},t.prototype[Symbol.replace]=function(t,n){if("string"==typeof n){var i=e.get(this);return r[Symbol.replace].call(this,t,n.replace(/\$<([^>]+)>/g,(function(r,e){return"$"+i[e]})))}if("function"==typeof n){var s=this;return r[Symbol.replace].call(this,t,(function(){var r=arguments;return"object"!=typeof r[r.length-1]&&(r=[].slice.call(r)).push(u(r,s)),n.apply(this,r)}))}return r[Symbol.replace].call(this,t,n)},n.apply(this,arguments)}function u(r,e){if(!(r instanceof e))throw new TypeError("Cannot call a class as a function")}function i(r,e){for(var t=0;t<e.length;t++){var n=e[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}function s(r,e,t){return e&&i(r.prototype,e),t&&i(r,t),r}function o(r,e,t){return e in r?Object.defineProperty(r,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):r[e]=t,r}function a(r,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function");r.prototype=Object.create(e&&e.prototype,{constructor:{value:r,writable:!0,configurable:!0}}),e&&f(r,e)}function d(r){return d=Object.setPrototypeOf?Object.getPrototypeOf:function(r){return r.__proto__||Object.getPrototypeOf(r)},d(r)}function f(r,e){return f=Object.setPrototypeOf||function(r,e){return r.__proto__=e,r},f(r,e)}function c(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(r){return!1}}function l(r,e,t){return l=c()?Reflect.construct:function(r,e,t){var n=[null];n.push.apply(n,e);var u=new(Function.bind.apply(r,n));return t&&f(u,t.prototype),u},l.apply(null,arguments)}function p(r){var e="function"==typeof Map?new Map:void 0;return p=function(r){if(null===r||-1===Function.toString.call(r).indexOf("[native code]"))return r;if("function"!=typeof r)throw new TypeError("Super expression must either be null or a function");if(void 0!==e){if(e.has(r))return e.get(r);e.set(r,t)}function t(){return l(r,arguments,d(this).constructor)}return t.prototype=Object.create(r.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),f(t,r)},p(r)}function h(r){if(null==r)throw new TypeError("Cannot destructure undefined")}function m(r,e){if(e&&("object"==typeof e||"function"==typeof e))return e;if(void 0!==e)throw new TypeError("Derived constructors may only return object or undefined");return function(r){if(void 0===r)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return r}(r)}function v(r){var e=c();return function(){var t,n=d(r);if(e){var u=d(this).constructor;t=Reflect.construct(n,arguments,u)}else t=n.apply(this,arguments);return m(this,t)}}function b(r,e){return function(r){if(Array.isArray(r))return r}(r)||function(r,e){var t=null==r?null:"undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(null!=t){var n,u,i=[],s=!0,o=!1;try{for(t=t.call(r);!(s=(n=t.next()).done)&&(i.push(n.value),!e||i.length!==e);s=!0);}catch(r){o=!0,u=r}finally{try{s||null==t.return||t.return()}finally{if(o)throw u}}return i}}(r,e)||y(r,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function g(r){return function(r){if(Array.isArray(r))return w(r)}(r)||function(r){if("undefined"!=typeof Symbol&&null!=r[Symbol.iterator]||null!=r["@@iterator"])return Array.from(r)}(r)||y(r)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(r,e){if(r){if("string"==typeof r)return w(r,e);var t=Object.prototype.toString.call(r).slice(8,-1);return"Object"===t&&r.constructor&&(t=r.constructor.name),"Map"===t||"Set"===t?Array.from(r):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?w(r,e):void 0}}function w(r,e){(null==e||e>r.length)&&(e=r.length);for(var t=0,n=new Array(e);t<e;t++)n[t]=r[t];return n}var A=function(r){a(t,r);var e=v(t);function t(r){var n;return u(this,t),(n=e.call(this,'No command found for input "'.concat(r,'"'))).name="CommandNotFoundError",n}return t}(p(Error)),x=function(r){a(t,r);var e=v(t);function t(r,n){var i;return u(this,t),(i=e.call(this,'Input "'.concat(r,'" is invalid for command "').concat(n,'"'))).name="CommandParseError",i}return t}(p(Error)),E=function(r){a(t,r);var e=v(t);function t(){var r;return u(this,t),(r=e.call(this,"0 only valid for append (a) and read (r) commands")).name="ZeroAddressingError",r}return t}(p(Error)),S=function(r){a(t,r);var e=v(t);function t(r,n){var i;return u(this,t),(i=e.call(this,'Cannot access address "'.concat(r,'" of buffer length "').concat(n,'"'))).name="BufferBoundsError",i}return t}(p(Error)),k=function(r){a(t,r);var e=v(t);function t(r,n){var i;return u(this,t),(i=e.call(this,'New address "'.concat(r,'" cannot be less than previous address "').concat(n,'"'))).name="AddressOrderError",i}return t}(p(Error)),O=function(r){a(t,r);var e=v(t);function t(r){var n;return u(this,t),(n=e.call(this,'"'.concat(r,'" is not a valid address'))).name="AddressParserError",n}return t}(p(Error)),j=function(r){a(t,r);var e=v(t);function t(){var r,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"no search term";return u(this,t),(r=e.call(this,'Failed to match "'.concat(n,'"'))).name="AddressSearchError",r}return t}(p(Error)),I=function(r){a(t,r);var e=v(t);function t(r){var n;return u(this,t),(n=e.call(this,'The buffer is empty, cannot execute command "'.concat(r,'"'))).name="EmptyBufferError",n}return t}(p(Error)),P=function(r){a(t,r);var e=v(t);function t(){var r;return u(this,t),(r=e.call(this,"Cannot access local storage")).name="StorageError",r}return t}(p(Error)),R=function(r){a(t,r);var e=v(t);function t(r){var n;return u(this,t),(n=e.call(this,"Cannot read file ".concat(r))).name="FileReadError",n}return t}(p(Error)),q=function(r){a(t,r);var e=v(t);function t(){var r;return u(this,t),(r=e.call(this,"No regex to use for search")).name="EmptyRegexError",r}return t}(p(Error)),T=function(r){a(t,r);var e=v(t);function t(r){var n;return u(this,t),(n=e.call(this,"Failed to match ".concat(r," on all addressed lines"))).name="MatchError",n}return t}(p(Error)),M=function(){function r(){u(this,r)}return s(r,null,[{key:"validateAddress",value:function(r,e){var t=r.address,n=r.buffer;if(e<n.length&&e>=0){if(t!==[]&&e<t[t.length-1])throw new k(e,t[t.length-1]);return!0}throw new S(t,n.length)}},{key:"parseDigits",value:function(r,e){var t="";do{t+=e.charAt(r++)}while(r<e.length&&Number.isInteger(parseInt(e[r])));return[{},parseInt(t),r]}},{key:"incrementIndex",value:function(r,e,t){return h(r),[{},e,t+=1]}},{key:"dot",value:function(r,e,t){return[{},r.currentAddress,t+=1]}},{key:"dollar",value:function(r,e,t){return[{},r.buffer.length-1,t+=1]}},{key:"semicolon",value:function(e,t,n){var u=e.address;if(n+=1,r.validateAddress({address:u,buffer:e.buffer},t)){var i=g(u);return i.push(t),[{address:i,currentAddress:t},0,n]}throw new O(t)}},{key:"comma",value:function(e,t,n){var u=e.address;if(n+=1,r.validateAddress({address:u,buffer:e.buffer},t)){var i=g(u);return i.push(t),[{address:i},0,n]}throw new O(t)}},{key:"endAddress",value:function(e,t,n){var u=e.address;if(null===t)return[{address:[]},0,0];if(r.validateAddress({address:u,buffer:e.buffer},t)){var i=g(u);return i.push(t),[{address:i},0,n]}throw new O(t)}},{key:"math",value:function(e,t,n,u){var i=b(r.parseDigits(n,e.input),3);return h(i[0]),n=i[2],[{},t=parseInt(i[1])*u+parseInt(t),n]}},{key:"slash",value:function(r,e,t){var n,u=r.input,i=r.buffer,s=r.currentAddress,o=r.regex;if(n="//"===u.slice(t,t+2)?o:u.slice(t).match(/^(\/.*?(?<!\\)\/)/)[0].slice(1,-1)){for(var a=new RegExp(n),d=s+1;d<s+i.length;d++){var f=d%i.length;if(f&&a.exec(i[f]))return t+=n!==o?n.length+2:2,[{regex:o=n},f,t]}throw new j(n)}throw new j(n)}},{key:"query",value:function(r,e,t){var n,u=r.input,i=r.buffer,s=r.currentAddress,o=r.regex;if(n="??"===u.slice(t,t+2)?o:u.slice(t).match(/^(\?.*?(?<!\\)\?)/)[0].slice(1,-1)){for(var a=new RegExp(n),d=s+i.length-1;d>=s;d--){var f=d%i.length;if(f&&a.exec(i[f]))return[{regex:o},f,t+=n!==o?n.length+2:2]}throw new j(n)}throw new j(n)}},{key:"buildAddress",value:function(r){var t,n,u=new B,i=e(e({},r),{},{address:g(r.address)}),s=null,o=0;do{var a=B.addressMap[i.input[o]]||"end",d=b(u[u.current][a].transition(i,s,o),3);t=d[0],s=d[1],n=d[2],u.current=a,i=e(e({},i),t),o=n}while("end"!==u.current);return i.input=i.input.slice(o)||"",i}}]),r}(),B=function r(){u(this,r),o(this,"current","initial"),o(this,"initial",{digit:{transition:function(r,e,t){return M.parseDigits(t,r.input)}},slash:{transition:function(r,e,t){return M.slash({input:r.input,buffer:r.buffer,currentAddress:r.currentAddress,regex:r.regex},e,t)}},query:{transition:function(r,e,t){return M.query({input:r.input,buffer:r.buffer,currentAddress:r.currentAddress,regex:r.regex},e,t)}},dot:{transition:function(r,e,t){return M.dot({currentAddress:r.currentAddress},e,t)}},dollar:{transition:function(r,e,t){return M.dollar({buffer:r.buffer},e,t)}},end:{transition:function(r,e,t){return M.endAddress({address:r.address,buffer:r.buffer},e,t)}}}),o(this,"digit",{comma:{transition:function(r,e,t){return M.comma({address:r.address,buffer:r.buffer},e,t)}},plus:{transition:function(r,e,t){return h(r),M.incrementIndex({},e,t)}},minus:{transition:function(r,e,t){return h(r),M.incrementIndex({},e,t)}},semicolon:{transition:function(r,e,t){return M.semicolon({address:r.address,buffer:r.buffer},e,t)}},end:{transition:function(r,e,t){return M.endAddress({address:r.address,buffer:r.buffer},e,t)}}}),o(this,"comma",{digit:{transition:function(r,e,t){return M.parseDigits(t,r.input)}},slash:{transition:function(r,e,t){return M.slash({input:r.input,buffer:r.buffer,currentAddress:r.currentAddress,regex:r.regex},e,t)}},query:{transition:function(r,e,t){return M.query({input:r.input,buffer:r.buffer,currentAddress:r.currentAddress,regex:r.regex},e,t)}},dot:{transition:function(r,e,t){return M.dot({currentAddress:r.currentAddress},e,t)}},dollar:{transition:function(r,e,t){return M.dollar({buffer:r.buffer},e,t)}}}),o(this,"semicolon",{digit:{transition:function(r,e,t){return M.parseDigits(t,r.input)}},slash:{transition:function(r,e,t){return M.slash({input:r.input,buffer:r.buffer,currentAddress:r.currentAddress,regex:r.regex},e,t)}},query:{transition:function(r,e,t){return M.query({input:r.input,buffer:r.buffer,currentAddress:r.currentAddress,regex:r.regex},e,t)}},dot:{transition:function(r,e,t){return M.dot({currentAddress:r.currentAddress},e,t)}},dollar:{transition:function(r,e,t){return M.dollar({buffer:r.buffer},e,t)}}}),o(this,"slash",{digit:{transition:function(r,e,t){return M.math({input:r.input},e,t,1)}},comma:{transition:function(r,e,t){return M.comma({address:r.address,buffer:r.buffer},e,t)}},semicolon:{transition:function(r,e,t){return M.semicolon({address:r.address,buffer:r.buffer},e,t)}},plus:{transition:function(r,e,t){return h(r),M.incrementIndex({},e,t)}},minus:{transition:function(r,e,t){return h(r),M.incrementIndex({},e,t)}},end:{transition:function(r,e,t){return M.endAddress({address:r.address,buffer:r.buffer},e,t)}}}),o(this,"query",{digit:{transition:function(r,e,t){return M.math({input:r.input},e,t,1)}},comma:{transition:function(r,e,t){return M.comma({address:r.address,buffer:r.buffer},e,t)}},semicolon:{transition:function(r,e,t){return M.semicolon({address:r.address,buffer:r.buffer},e,t)}},plus:{transition:function(r,e,t){return h(r),M.incrementIndex({},e,t)}},minus:{transition:function(r,e){return M.incrementIndex({index:r.index},e)}},end:{transition:function(r,e,t){return M.endAddress({address:r.address,buffer:r.buffer},e,t)}}}),o(this,"plus",{digit:{transition:function(r,e,t){return M.math({input:r.input},e,t,1)}}}),o(this,"minus",{digit:{transition:function(r,e,t){return M.math({input:r.input},e,t,-1)}}}),o(this,"dot",{digit:{transition:function(r,e,t){return M.math({input:r.input},e,t,1)}},comma:{transition:function(r,e,t){return M.comma({address:r.address,buffer:r.buffer},e,t)}},semicolon:{transition:function(r,e,t){return M.semicolon({address:r.address,buffer:r.buffer},e,t)}},plus:{transition:function(r,e,t){return h(r),M.incrementIndex({},e,t)}},minus:{transition:function(r,e,t){return h(r),M.incrementIndex({},e,t)}},end:{transition:function(r,e,t){return M.endAddress({address:r.address,buffer:r.buffer},e,t)}}}),o(this,"dollar",{minus:{transition:function(r,e,t){return h(r),M.incrementIndex({},e,t)}},comma:{transition:function(r,e,t){return M.comma({address:r.address,buffer:r.buffer},e,t)}},semicolon:{transition:function(r,e,t){return M.semicolon({address:r.address,buffer:r.buffer},e,t)}},end:{transition:function(r,e,t){return M.endAddress({address:r.address,buffer:r.buffer},e,t)}}}),o(this,"end",{})};function C(r,e){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[e,e];if(r.length>0){if(t&&r.length>1){if(0===r[r.length-2]||0===r[r.length-1])throw new ZeroAddressingError;return[r[r.length-2],r[r.length-1]]}if(t){if(0===r[0])throw new ZeroAddressingError;return[r[0],r[0]]}return[r[r.length-1],r[r.length-1]]}return n}function D(r){var e=r.address,t=r.buffer,n=r.currentAddress,u=r.output,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1],s=g(u);if(!n)throw new I("print");var o=C(e,n),a=b(o,2),d=a[0],f=a[1];if(i)for(var c=d;c<=f;c++)s.push(t[c]+"$");else for(var l=d;l<=f;l++)s.push(t[l]);return{output:s,currentAddress:n=f}}function N(r){var e=r.buffer,t=r.address,n=r.currentAddress;if(!n)throw new I("delete");var u=g(e),i=C(t,n);return u.splice(i[0],i[1]-i[0]+1),{buffer:u,currentAddress:n=1===u.length?0:i[1]===e.length-1?i[0]-1:i[0]}}function _(r){var e=r.buffer,t=r.input,n=r.currentAddress,u=r.address,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(t&&"p"!==t.trim())throw new x(t.trim(),"insert");if(i){var s=C(u,n,!1),o=b(s,2);n=o[1],n+=1}else{var a=C(u,n),d=b(a,2);n=d[1],1!==e.length||n||(
//allow insert on empty buffer with no address
n=1)}var f="input",c=t;return{currentAddress:n,backup:c,mode:f,input:t=""}}function L(r){var e=r.input,n=r.address,u=r.buffer,i=r.currentAddress,s=r.output;if(void 0!==("undefined"==typeof Storage?"undefined":t(Storage))){var o=e.trim();if(o){var a=[];try{a=JSON.parse(localStorage.getItem(o))}catch(r){throw new R(o)}if(!a)throw new R(o);var d=g(u),f=b(C(n,i,!1,[0,u.length-1]),2)[1];d.splice.apply(d,[f+1,0].concat(g(a))),f+=a.length;var c=g(s);return c.push(a.reduce((function(r,e){return r+e.length}),0).toString()),{currentAddress:f,output:c,buffer:d,filename:o}}if(filename){var l=[];try{l=JSON.parse(localStorage.getItem(filename))}catch(r){throw new R(filename)}var p=g(u),h=b(C(n,i,!1,[0,u.length-1]),2)[1];p.splice.apply(p,[h+1,0].concat(g(l))),h+=l.length;var m=g(s);return m.push(l.reduce((function(r,e){return r+e.length}),0).toString()),{currentAddress:h,output:m,buffer:p,filename}}throw new x(" ","read")}throw new P}o(B,"addressMap",{0:"digit",1:"digit",2:"digit",3:"digit",4:"digit",5:"digit",6:"digit",7:"digit",8:"digit",9:"digit",",":"comma",";":"semicolon","/":"slash","?":"query","+":"plus","-":"minus",".":"dot",$:"dollar"});var F=function(){function r(){u(this,r),o(this,"status","initial")}return s(r,null,[{key:"commandMap",value:function(e,t){if(t&&t[0]){var n=r.mapping[t[0]];if(r[e].hasOwnProperty(n))return[n,t.slice(1)];throw new A(t)}return["end",""]}}]),r}();o(F,"mapping",{a:"append",c:"change",d:"delete",e:"edit","=":"equals",g:"global",i:"insert",l:"list",p:"print",q:"quit",r:"read",s:"substitute",w:"write"}),o(F,"initial",{end:{next:function(r){if(r.address[0]){var t=r.address[0];return e(e({},r),{},{currentAddress:t,address:[]})}var n=function(r){if(r.currentAddress<r.buffer.length-1){var t=r.currentAddress+1,n=Command.print(e(e({},r),{},{currentAddress:t}));return{output:n.output,currentAddress:n.currentAddress}}throw new BufferBoundsError(r.currentAddress+1,r.buffer.length-1)}(r),u=n.output,i=n.currentAddress;return e(e({},r),{},{output:u,currentAddress:i,address:[]})}},quit:{next:function(r){var t=N(e(e({},r),{},{address:[1,r.buffer.length]})),n=t.buffer,u=t.currentAddress;return e(e({},r),{},{buffer:n,currentAddress:u,address:[],output:["goodbye"]})}},print:{next:function(r){var t=D(r),n=t.output,u=t.currentAddress;return e(e({},r),{},{output:n,currentAddress:u,address:[]})}},list:{next:function(r){var t=D(r,!0),n=t.output,u=t.currentAddress;return e(e({},r),{},{output:n,currentAddress:u,address:[]})}},equals:{next:function(r){var t,n=C((t=r).address,t.buffer.length-1)[1];return e(e({},r),{},{output:[].concat(g(r.output),[n]),address:[]})}},delete:{next:function(r){var t=N(r),n=t.buffer,u=t.currentAddress;return e(e({},r),{},{buffer:n,currentAddress:u,address:[]})}},append:{next:function(r){var t=_(r,1),n=t.currentAddress,u=t.backup,i=t.input,s=t.mode;return e(e({},r),{},{currentAddress:n,backup:u,input:i,mode:s,address:[]})}},insert:{next:function(r){var t=_(r,0),n=t.currentAddress,u=t.backup,i=t.input,s=t.mode;return e(e({},r),{},{currentAddress:n,backup:u,input:i,mode:s,address:[]})}},change:{next:function(r){var t=N(r),n=_(e(e(e({},r),t),{},{address:[]}),0),u=n.currentAddress,i=n.backup,s=n.input,o=n.mode;return e(e({},r),{},{currentAddress:u,backup:i,input:s,mode:o,address:[],buffer:t.buffer})}},read:{next:function(r){var t=L(r),n=t.buffer,u=t.currentAddress,i=t.output,s=t.filename;return e(e({},r),{},{buffer:n,currentAddress:u,output:i,filename:s,input:"",address:[]})}},write:{next:function(r){var t=function(r){var e=r.input,t=r.filename,n=r.buffer,u=r.output;if("undefined"!=typeof Storage){var i=b(C(r.address,r.currentAddress,!0,[1,n.length-1]),2),s=i[0],o=i[1],a=e.trim();if(a){localStorage.setItem(a,JSON.stringify(n.slice(s,o+1)));var d=g(u);return d.push(n.slice(s,o+1).reduce((function(r,e){return r+e.length}),0).toString()),{output:d,filename:a}}if(t){localStorage.setItem(t,JSON.stringify(n.slice(s,o+1)));var f=g(u);return f.push(n.slice(s,o+1).reduce((function(r,e){return r+e.length}),0).toString()),u=[].concat(g(u),[f]),{output:f,filename:a}}throw new x("","write")}throw new P}(r),n=t.output,u=t.filename;return e(e({},r),{},{output:n,filename:u,address:[],input:""})}},edit:{next:function(r){var t=L(e(e({},r),{},{buffer:["nope"],currentAddress:0})),n=t.buffer,u=t.currentAddress,i=t.output,s=t.filename;return e(e({},r),{},{buffer:n,currentAddress:u,output:i,filename:s,input:""})}},global:{next:function(r){var t=function(r){var e=r.input,t=r.address,n=r.buffer,u=r.currentAddress,i=r.regex,s=[];if("/"===e[0]){var o,a,d=e.match(/^(\/.*?(?<!\\)\/)/)[0].slice(1,-1),f=e.slice(d.length+2);""===d?o=new RegExp(i):(o=new RegExp(d),i=d);var c=b(C(t,u,!0,[1,n.length-1]),2);a=c[1];for(var l=c[0];l<=a;l++)o.exec(n[l])&&s.push(l);if(s[0])return{input:f,mode:"global",marks:s,regex:i,restrictions:["append","change","insert"]};throw new T(d)}throw new x(e,"global")}(r),n=t.input,u=t.mode,i=t.marks,s=t.regex;return e(e({},r),{},{input:n,mode:u,marks:i,regex:s,address:[]})}},substitute:{next:function(r){var t=function(r){var e,t,u,i=r.input,s=r.address,o=r.buffer,a=r.currentAddress,d=r.regex,f=n(/^((?:(?! )[\s\S]){1})(.*?)(?<!\\)\1(.*?)(?<!\\)\1(.*?)$/,{first:2,second:3,remaining:4}).exec(i);if(null===f)throw new x(i,"substitute");if(null!=f&&null!==(e=f.groups)&&void 0!==e&&e.first)d=u=f.groups.first;else{if(""!==f.groups.first)throw new q;u=d}if(null!=f&&null!==(t=f.groups)&&void 0!==t&&t.second){for(var c,l,p,h,m=f.groups.second.replace(/(?<!\\)&/,u),v=C(s,a),b=g(o),y=!0,w=RegExp(u),A=v[0];A<=v[1];A++)if(w.exec(b[A])){var E=b[A].replace(w,m);y=!1,b.splice(A,1,E),a=A}if(y)throw new T(w);return{buffer:b,currentAddress:a,input:(null===(c=f.groups)||void 0===c||null===(l=c.remaining)||void 0===l?void 0:l.length)>0?i.slice(-(null===(p=f.groups)||void 0===p||null===(h=p.remaining)||void 0===h?void 0:h.length)):"",regex:d}}//  }
}(r),u=t.buffer,i=t.currentAddress,s=t.input,o=t.regex;return e(e({},r),{},{buffer:u,currentAddress:i,input:s,address:[],regex:o})}}}),o(F,"end",{}),o(F,"quit",{end:{next:function(r){return r}}}),o(F,"print",{end:{next:function(r){return r}}}),o(F,"list",{end:{next:function(r){return r}}}),o(F,"equals",{end:{next:function(r){return r}},print:{next:function(r){var t=D(r),n=t.output,u=t.currentAddress;return e(e({},r),{},{output:n,currentAddress:u,address:[]})}}}),o(F,"delete",{end:{next:function(r){return r}}}),o(F,"append",{end:{next:function(r){return r}}}),o(F,"insert",{end:{next:function(r){return r}}}),o(F,"change",{end:{next:function(r){return r}}}),o(F,"read",{end:{next:function(r){return r}},print:{next:function(r){var t=D(r),n=t.output,u=t.currentAddress;return e(e({},r),{},{output:n,currentAddress:u,address:[]})}}}),o(F,"write",{end:{next:function(r){return r}},print:{next:function(r){var t=D(r),n=t.output,u=t.currentAddress;return e(e({},r),{},{output:n,currentAddress:u,address:[]})}}}),o(F,"edit",{end:{next:function(r){return r}},print:{next:function(r){var t=D(r),n=t.output,u=t.currentAddress;return e(e({},r),{},{output:n,currentAddress:u,address:[]})}}}),o(F,"global",{end:{next:function(r){return r}}}),o(F,"substitute",{end:{next:function(r){return r}},print:{next:function(r){var t=D(r),n=t.output,u=t.currentAddress;return e(e({},r),{},{output:n,currentAddress:u,address:[]})}}});var $=function(){function r(){u(this,r),o(this,"state",{regex:"ed",filename:"",status:"initial",address:[],currentAddress:1,input:"",mode:"command",marks:null,buffer:["nope","hello","from","ed","ed!"],
//"nope" so address 1 == buffer[1]
output:[],backup:[],restrictions:null})}return s(r,[{key:"execute",value:function(r){var n=this;if(!r.marks){var u=M.buildAddress(r),i=e(e({},r),u);//AddressFSM.AddressParser.
i.status="initial";do{var s=b(F.commandMap(i.status,i.input),2),o=s[0],a=s[1];if(i.restrictions&&i.restrictions.includes(o))throw new CommandRestrictedError(o);i.input=a,(i=e({},F[i.status][o].next(i))).status=o}while("end"!==i.status&&"global"!==i.status);return i}var d=function(){var t=g(r.marks),u=r.buffer.length,i=r.input,s=e({},r);s.marks=null;for(var o=0;o<t.length;){s.input=i,s.currentAddress=t[o];var a=void 0;do{a=n.execute(s),s=e(e({},s),a)}while(s.input);u>s.buffer.length&&function(){var r=u-s.buffer.length;u=s.buffer.length,t=t.map((function(e){return e>s.currentAddress?e-=r:e}))}(),u<s.buffer.length&&function(){var r=s.buffer.length-u;u=s.buffer.length,t=t.map(0!==s.address.length?function(e){return e>s.address[s.address.length-1]?e+=r:e}:function(e){return e>s.currentAddress?e+=r:e})}(),s.address=[],o++}return{v:s}}();if("object"===t(d))return d.v}},{key:"edit",value:function(r){if("."===r){if(this.state.mode="command",this.state.currentAddress--,this.state.backup){var e=this.state.backup;return this.state.backup="",this.readLine(e)}return{explanation:null,lines:[]}}return this.state.buffer.splice(this.state.currentAddress,0,r),this.state.currentAddress++,{explanation:null,lines:[]}}},{key:"readLine",value:function(r){if("input"==this.state.mode)return this.edit(r);this.state.input=r.trim();var t={};do{try{t=this.execute(this.state)}catch(r){return this.state=e(e({},this.state),{},{marks:null,restrictions:null}),{explanation:"".concat(r.name,": ").concat(r.message),lines:"?"}}this.state=e(e({},this.state),t)}while(this.state.input);var n={explanation:null,lines:this.state.output};return this.state.output=[],this.state.address=[],n}}],[{key:"getAddress",value:function(r,e){var t=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[e,e];if(r.length>0){if(t&&r.length>1){if(0===r[r.length-2]||0===r[r.length-1])throw new E;return[r[r.length-2],r[r.length-1]]}if(t){if(0===r[0])throw new E;return[r[0],r[0]]}return[r[r.length-1],r[r.length-1]]}return n}}]),r}(),H=new $,J=document.getElementById("ed-input"),Z=document.getElementById("ed-output"),U=document.getElementById("errors");J.addEventListener("keyup",(function(r){return function(r){if("Enter"===r.key){var e=J.value;Z.innerHTML+=e+"<br>";var t=H.readLine(e),n=t.explanation,u=t.lines;if(u&&null!==u[0]){var i,s=function(r,e){var t="undefined"!=typeof Symbol&&r[Symbol.iterator]||r["@@iterator"];if(!t){if(Array.isArray(r)||(t=y(r))){t&&(r=t);var n=0,u=function(){};return{s:u,n:function(){return n>=r.length?{done:!0}:{done:!1,value:r[n++]}},e:function(r){throw r},f:u}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,o=!1;return{s:function(){t=t.call(r)},n:function(){var r=t.next();return s=r.done,r},e:function(r){o=!0,i=r},f:function(){try{s||null==t.return||t.return()}finally{if(o)throw i}}}}(u);try{for(s.s();!(i=s.n()).done;)Z.innerHTML+=i.value+"<br>"}catch(r){s.e(r)}finally{s.f()}}U.innerHTML=n?"".concat(n,"<br>"):"",(o=Z).scrollTop=o.scrollHeight,J.value=""}var o}(r)}))}();
//# sourceMappingURL=bundle.js.map
